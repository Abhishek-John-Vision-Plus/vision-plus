// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String             @id @default(uuid())
  name          String
  email         String             @unique
  empId         String             @unique
  password      String
  process       String
  phone         String? // ✅ new column
  role          String             @default("USER") // ✅ new column
  createdAt     DateTime           @default(now())
  questionCount Int                @default(15) // ✅ new column: number of questions user must answer
  details       UserDetails?
  assessments   AssessmentResult[]
  assigned      AssignedQuestion[]
}

model UserDetails {
  id               String   @id @default(uuid())
  userId           String   @unique
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  firstName        String
  lastName         String
  phoneNumber      String
  gender           String
  state            String
  city             String
  dateOfBirth      String
  teamLead         String
  language         String
  processAllocated String
  designation      String
  address          String
  consent          Boolean
  updatedAt        DateTime @updatedAt
}

model AssessmentResult {
  id             String   @id @default(uuid())
  userId         String
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  process        String
  score          Float
  correctAnswers Int
  wrongAnswers   Int
  totalQuestions Int
  answers        Json // Stores { questionId: selectedOption }
  percentage     Float
  status         String // e.g., "COMPLETED", "FAILED", "PASSED"
  createdAt      DateTime @default(now())

  @@index([userId])
}

model Mcq {
  id            String             @id @default(uuid())
  question      String
  type          String             @default("MCQ")
  options       Json?
  correctAnswer String?
  option_a      String?
  option_b      String?
  option_c      String?
  option_d      String?
  correctOption String?
  process       String?
  category      String?
  module        String?
  role          String?            @default("BOTH")
  sourceFile    String?
  createdAt     DateTime           @default(now())
  assignedBy    AssignedQuestion[]

  @@map("mcqs")
}

model AssignedQuestion {
  id         String   @id @default(uuid())
  userId     String
  mcqId      String
  assignedBy String?
  createdAt  DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  mcq  Mcq  @relation(fields: [mcqId], references: [id], onDelete: Cascade)

  @@unique([userId, mcqId])
  @@index([userId])
  @@index([mcqId])
}
